import{d as M,a as K,c as Q,p as Y,D as ee,C as te,s as ae,x as ne}from"./carteFrance-BRH0lLrC.js";import{l as N,o as j,b as u,c as _,e as t,F as oe,j as se,t as y,a as c,d as le,m as R,r as p,i as A,g as V,_ as G,n as w,q as re,f as q,p as ie,h as ce}from"./index-sfIzfdUg.js";const ue={class:"tableau-donnees table table-bordered table-hover"},_e=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Catégorie"),t("th",{scope:"col"},"Nombre de bénéficiaires"),t("th",{scope:"col",class:"no-crop"},"Montant")])],-1),de={class:"no-crop"},fe={class:"dt total-row"},me=t("td",null,"Total",-1),pe={class:"no-crop"},L={__name:"affDonneesCPSTI",props:["data"],setup(v){const f=v;console.log(f.data);const D=a=>a.secteur_NA21,I=N(()=>[...f.data].sort((a,r)=>{const i=D(a),h=D(r);return i<h?-1:i>h?1:0})),S=N(()=>f.data.reduce((a,r)=>a+r.nombre_de_beneficiaires,0)),m=N(()=>f.data.reduce((a,r)=>a+r.montant_total,0));function d(){const a=document.querySelectorAll(".no-crop p");let r=0;console.log(a),a.forEach(i=>{r=Math.max(r,i.offsetWidth),console.log(r)}),r=r+40,document.querySelectorAll(".no-crop").forEach(i=>{i.style.width=`${r}px`})}return j(()=>{d()}),(a,r)=>(u(),_("table",ue,[_e,t("tbody",null,[(u(!0),_(oe,null,se(I.value,(i,h)=>(u(),_("tr",{key:h,class:"dt champ"},[t("td",null,y(i.secteur_NA21),1),t("td",null,[t("p",null,y(i.nombre_de_beneficiaires.toLocaleString("fr",{useGrouping:!0})),1)]),t("td",de,[t("p",null,y(c(M)(i.montant_total).toLocaleString("fr",{useGrouping:!0}))+" k€ ",1)])]))),128)),t("tr",fe,[me,t("td",null,[t("p",null,y(S.value.toLocaleString("fr",{useGrouping:!0})),1)]),t("td",pe,[t("p",null,y(c(M)(m.value).toLocaleString("fr",{useGrouping:!0}))+" k€",1)])])])]))}},he={key:0},be={key:0,class:"dashboard content"},ge={key:0,class:"dashboard map"},ve={class:"dashboard aff-donnees"},De={key:0},Ce={key:1},xe={class:"dashboard donnees"},Ie={key:0,class:"donnees-region"},Se={key:1,class:"donnees-agregees"},Ve={key:1},ye=le({__name:"cpsti",setup(v){let f,D,I,S,m=R([]),d=R([]),a,r="Montant total de l'aide",i=R([]),h=R([]);const k=p(!1),P=p(!1),b=p(!1),$=p(!1),T=p(!1);p(1),p(1);const F=p(ee),E=p(!1),O=p(!0);function z(){te.forEach(s=>{m.push({zoneGeo:s,value:0}),D.filter(e=>e.code_region==s).forEach(e=>{m[m.length-1].value+=+e.montant_total})});let l=m.map(s=>s.value),n=Math.max(...l);return[Math.min(...l),n]}function W(){ae.forEach(s=>{d.push({zoneGeo:s,value:0}),I.filter(e=>e.code_departement==s).forEach(e=>{d[d.length-1].value+=+e.montant_total})});let l=d.map(s=>s.value),n=Math.max(...l);return[Math.min(...l),n]}function H(){S=f.reduce((n,o)=>{let s=n.find(C=>C.secteur_NA21===o.secteur_NA21);return s?(s.montant_total+=o.montant_total,s.nombre_de_beneficiaires+=o.nombre_de_beneficiaires):n.push({secteur_NA21:o.secteur_NA21,montant_total:o.montant_total,nombre_de_beneficiaires:o.nombre_de_beneficiaires}),n},[]),console.log("données nationales : ",S),$.value=!0}function U(l){b.value=!1,a=D.filter(n=>n.code_region==l),b.value=!0}function X(l){b.value=!1,a=I.filter(n=>n.code_departement==l),console.log(a),b.value=!0}async function Z(){if(!E.value){E.value=!0,f=[],m.splice(0,m.length),d.splice(0,d.length);try{const[l]=await Promise.all([Q(F.value,";")]);console.log(l),f=l;let n={},o={};f.forEach(e=>{e.montant_total=+e.montant_total,e.nombre_de_beneficiaires=+e.nombre_de_beneficiaires,e.montant_total_en_millions=+e.montant_total_en_millions,e.secteur_NA21=e.secteur_NA21.substring(1+e.code_NA21.length);let g=`${e.code_region}-${e.secteur_NA21}`,x=`${e.code_departement}-${e.secteur_NA21}`,{geo_point:Me,code_departement:we,departement:Le,...J}=e;n[g]?(n[g].nombre_de_beneficiaires+=e.nombre_de_beneficiaires,n[g].montant_total+=e.montant_total,n[g].montant_total_en_millions+=e.montant_total_en_millions):n[g]={...J,nombre_de_beneficiaires:e.nombre_de_beneficiaires,montant_total:e.montant_total,montant_total_en_millions:e.montant_total_en_millions},o[x]?(o[x].nombre_de_beneficiaires+=e.nombre_de_beneficiaires,o[x].montant_total+=e.montant_total,o[x].montant_total_en_millions+=e.montant_total_en_millions):o[x]={...e,nombre_de_beneficiaires:e.nombre_de_beneficiaires,montant_total:e.montant_total,montant_total_en_millions:e.montant_total_en_millions}}),D=Object.values(n),I=Object.values(o),i.splice(0,i.length),z().forEach(e=>i.push(e)),h.splice(0,h.length),W().forEach(e=>h.push(e)),k.value=!0,P.value=!0}catch(l){console.log("Erreur chargement données : ",l),T.value=!0}finally{E.value=!1}}}return j(async()=>{await Z(),H()}),(l,n)=>{var o,s,C,e;return k.value?(u(),_("div",he,[T.value?(u(),_("div",Ve)):(u(),_("div",be,[P.value?(u(),_("div",ge,[A(K,{mesure:c(r),echelleCouleur:c(Y),existeInfosDepts:O.value,tabDonneesAfficheesRegion:c(m),minMaxValeursRegion:c(i),tabDonneesAfficheesDep:c(d),minMaxValeursDep:c(h),onClicZoneGeo:n[0]||(n[0]=(g,x)=>{x?U(g):X(g)})},null,8,["mesure","echelleCouleur","existeInfosDepts","tabDonneesAfficheesRegion","minMaxValeursRegion","tabDonneesAfficheesDep","minMaxValeursDep"])])):V("",!0),t("div",ve,[b.value?(u(),_("h2",De," Données "+y((o=c(a)[0])!=null&&o.departement?(s=c(a)[0])==null?void 0:s.departement:(C=c(a)[0])!=null&&C.region?(e=c(a)[0])==null?void 0:e.region:"manquantes"),1)):V("",!0),$.value&&!b.value?(u(),_("h2",Ce,"Données Nationales")):V("",!0),t("div",xe,[b.value?(u(),_("div",Ie,[A(L,{data:c(a)},null,8,["data"])])):V("",!0),$.value&&!b.value?(u(),_("div",Se,[A(L,{data:c(S)},null,8,["data"])])):V("",!0)])])]))])):V("",!0)}}}),Ae=G(ye,[["__scopeId","data-v-bb1f3042"]]),Re={components:{cpsti:Ae},data(){return{themeCPSTI:ne}}},B=v=>(ie("data-v-a1123e4e"),v=v(),ce(),v),$e={class:"d-flex flex-row justify-content-between algin-items-flex-end"},Ee=B(()=>t("div",{class:"title-dashboards"},[t("h2",null,"Aides de la CPSTI")],-1)),Ne={class:"link_homepage"},ke={class:"content-dashboards"},Pe=B(()=>t("div",{class:"texte-presentation-tableaux-bord"},[t("p",null,"Cette aide a été créée par le Conseil de la protection sociale des travailleurs indépendants (CPSTI) en faveur des artisans/commerçants et leurs conjoints collaborateurs relevant du Régime Complémentaire des Indépendants (RCI) dans le cadre de la crise du Covid-19. Elle s'adresse à tous les artisans/commerçants et leurs conjoints collaborateurs : "),t("ul",null,[t("li",null,"relevant du Régime Complémentaire des Indépendants (RCI);"),t("li",null,"en activité au 15 mars 2020;"),t("li",null,"immatriculés avant le 1er janvier 2019")]),t("p",null,[q("Source : "),t("a",{href:"https://open.urssaf.fr/explore/dataset/aide-exceptionnelle-cpsti-covid-19/information/"},"Acoss-Urssaf")])],-1));function Te(v,f,D,I,S,m){const d=w("router-link"),a=w("cpsti");return u(),_("div",null,[t("header",$e,[Ee,t("nav",Ne,[A(d,{to:"/",exact:"",class:"text-white"},{default:re(()=>[q("Retour")]),_:1})])]),t("div",ke,[Pe,t("div",null,[A(a)])])])}const qe=G(Re,[["render",Te],["__scopeId","data-v-a1123e4e"]]);export{qe as default};
